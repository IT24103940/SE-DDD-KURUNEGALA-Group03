<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Edit Ticket</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        /* ===== BACKGROUND ===== */
        body {
            background: radial-gradient(circle at top right, #0b141b, #203a43, #0e1a21);
            font-family: "Poppins", sans-serif;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: gradientShift 12s ease infinite alternate;
        }

        /* ===== CONTAINER ===== */
        .container {
            width: 90%;
            max-width: 650px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.45);
            backdrop-filter: blur(15px);
        }

        h2 {
            color: #ffcc00;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.9rem;
            font-weight: 700;
            text-shadow: 0 0 12px rgba(255, 204, 0, 0.6);
        }

        label {
            font-weight: 600;
            color: #ffcc00;
            display: block;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 12px;
            border: none;
            outline: none;
            background: rgba(0, 0, 0, 0.4);
            color: #fff;
            font-size: 1rem;
            box-shadow: 0 0 12px rgba(164, 132, 255, 0.3);
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            box-shadow: 0 0 18px rgba(164, 132, 255, 0.8);
            background: rgba(0, 0, 0, 0.55);
        }

        select option {
            background-color: #0b132b;
            color: #fff;
            padding: 10px;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* ===== BUTTONS ===== */
        button {
            width: 100%;
            border: none;
            border-radius: 40px;
            padding: 14px 20px;
            font-size: 1.05rem;
            font-weight: 600;
            margin-top: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* Save Changes */
        button[type="submit"] {
            background: linear-gradient(135deg, #7c5cff, #a58bff);
            color: #fff;
            box-shadow: 0 0 15px rgba(124, 92, 255, 0.4);
        }

        button[type="submit"]:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 25px rgba(160, 128, 255, 0.9);
        }

        /* Cancel Button */
        .cancel-btn {
            display: inline-block;
            background: rgba(255, 255, 255, 0.08);
            color: #a58bff;
            text-decoration: none;
            font-weight: 600;
            text-align: center;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 20px;
            transition: 0.3s;
        }

        .cancel-btn:hover {
            background: rgba(164, 132, 255, 0.15);
            color: #fff;
            box-shadow: 0 0 12px rgba(164, 132, 255, 0.6);
        }

        /* ===== REPLIES ===== */
        h3 {
            margin-top: 30px;
            color: #ffcc00;
            font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }

        .reply-section {
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
        }

        .reply-section label {
            color: #ffcc00;
            font-weight: 600;
        }

        .reply-section textarea {
            background: rgba(0, 0, 0, 0.4);
            color: #fff;
            border-radius: 10px;
            width: 100%;
            margin-top: 8px;
        }

        .reply-section button {
            background: linear-gradient(135deg, #ffd500, #ff9900);
            color: #222;
            font-weight: 700;
            margin-top: 12px;
            box-shadow: 0 0 15px rgba(255, 200, 0, 0.5);
        }

        .reply-section button:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 25px rgba(255, 200, 0, 0.9);
        }

        em {
            color: #bbb;
            font-style: italic;
        }
    </style>
</head>

<body>
<div class="container">
    <h2>üõ†Ô∏è Edit Ticket</h2>

    <form th:action="@{'/customer/tickets/' + ${ticket.id} + '/edit'}" method="post">
        <label>üìù Subject:</label>
        <input type="text" name="subject" th:value="${ticket.subject}" required>

        <label>üí¨ Description:</label>
        <textarea name="description" required th:text="${ticket.description}"></textarea>

        <label>üéØ Priority:</label>
        <select name="priority" required>
            <option th:each="p : ${priorities}" th:value="${p}" th:text="${p}" th:selected="${p == ticket.priority}"></option>
        </select>

        <button type="submit">üíæ Save Changes</button>
    </form>

    <a th:href="@{/customer/tickets}" class="cancel-btn">‚ùå Cancel</a>

    <h3>üí¨ Replies</h3>

    <div th:if="${ticket.status == T(java.lang.Enum).valueOf(T(Group3.demo.Entity.enums.TicketStatus), 'IN_PROGRESS')}" class="reply-section">
        <form th:action="@{'/customer/tickets/' + ${ticket.id} + '/reply'}" method="post">
            <label>‚úâÔ∏è Reply to Support Officer:</label>
            <textarea name="message" required placeholder="Type your reply..."></textarea>
            <button type="submit">üì® Send Reply</button>
        </form>
    </div>

    <div th:if="${#lists.isEmpty(ticket.replies)}">
        <p><em>No replies yet.</em></p>
    </div>

    <div th:each="r : ${ticket.replies}">
        <p>
            <strong th:text="${r.author != null ? r.author.fullName : 'System'}"></strong>:
            <span th:text="${r.message}"></span>
            <span style="color:gray;font-size:smaller;" th:text="${#temporals.format(r.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
        </p>
    </div>
</div>
</body>
</html>
